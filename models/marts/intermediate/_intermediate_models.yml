version: 2

models:

  - name: int_orders
    description: >
      Modelo intermedio que combina información de pedidos, líneas de pedido, clientes y piezas-proveedor.
      Integra las tablas `stg_orders`, `stg_lineitem`, `stg_customer` y `stg_partsupp`
      para proporcionar una vista completa de cada transacción con datos de coste, cantidad,
      descuentos y fechas logísticas.
    config:
      tags: ["intermediate", "business", "orders"]
    columns:
      - name: order_id
        description: "Identificador del pedido (procedente de stg_orders)."
        tests:
          - not_null
          - relationships:
              arguments:
                field: order_id
                to: ref('stg_orders')

      - name: line_number
        description: "Número de línea del pedido que identifica cada artículo dentro de un pedido."
        tests:
          - not_null

      - name: part_id
        description: "Identificador de la pieza asociada a la línea de pedido."
        tests:
          - not_null
          - relationships:
              arguments:
                field: part_id
                to: ref('stg_part')

      - name: supplier_id
        description: "Identificador del proveedor que suministra la pieza."
        tests:
          - not_null
          - relationships:
              arguments:
                field: supplier_id
                to: ref('stg_supplier')

      - name: customer_id
        description: "Identificador del cliente que realiza el pedido."
        tests:
          - not_null
          - relationships:
              arguments:
                field: customer_id
                to: ref('stg_customer')

      - name: nation_id
        description: "Identificador de la nación del cliente, heredado de la dimensión de localización."
        tests:
          - relationships:
              arguments:
                field: nation_id
                to: ref('stg_nation')

      - name: quantity
        description: "Cantidad de piezas pedidas en la línea de pedido."
        tests:
          - positive_value

      - name: extended_price
        description: "Precio total de la línea de pedido antes de aplicar descuentos."
        tests:
          - positive_value

      - name: discount
        description: "Descuento aplicado a la línea de pedido, expresado como porcentaje decimal."
        tests:
          - positive_value

      - name: tax
        description: "Impuesto aplicado a la línea de pedido, expresado como porcentaje decimal."
        tests:
          - positive_value

      - name: return_flag
        description: "Indicador de si la línea ha sido devuelta."
        tests:
          - accepted_values:
              arguments:
                values:
                  - R
                  - N
                  - A

      - name: line_status
        description: "Estado actual de la línea de pedido (por ejemplo, entregada, pendiente, etc.)."
        tests:
          - accepted_values:
              arguments:
                values:
                  - F
                  - O

      - name: ship_date
        description: "Fecha de envío del pedido."
        tests:
          - date_after_1992

      - name: commit_date
        description: "Fecha comprometida para la entrega del pedido."
        tests:
          - date_after_1992

      - name: receipt_date
        description: "Fecha en la que el cliente recibe la mercancía."
        tests:
          - date_after_1992

      - name: ship_instruct
        description: "Instrucción especial de envío (por ejemplo, 'DELIVER IN PERSON')."

      - name: ship_mode
        description: "Modo de transporte utilizado para el envío (por ejemplo, 'AIR', 'SHIP')."

      - name: order_date
        description: "Fecha en la que se realizó el pedido."
        tests:
          - date_after_1992

      - name: clerk_id
        description: "Identificador numérico del empleado (clerk) responsable del pedido."

      - name: order_priority
        description: "Prioridad del pedido en formato numérico (extraído del texto original)."

      - name: supply_cost
        description: "Coste de suministro de la pieza proporcionado por el proveedor."
        tests:
          - positive_value

  - name: int_location
    description: >
      Modelo intermedio que combina las tablas `stg_nation` y `stg_region`
      para generar una dimensión de localización con información de nación y región.
      Se utiliza posteriormente como base de la dimensión `dim_location`.
    config:
      tags: ["intermediate", "business", "location"]
    columns:
      - name: nation_id
        description: "Identificador único de la nación, utilizado como clave primaria de la dimensión."
        tests:
          - unique
          - not_null
          - relationships:
              arguments:
                field: nation_id
                to: ref('stg_nation')

      - name: nation_name
        description: "Nombre de la nación normalizado (capitalizado)."
        tests:
          - not_null

      - name: region_name
        description: "Nombre de la región asociada a la nación (capitalizado)."
        tests:
          - not_null
